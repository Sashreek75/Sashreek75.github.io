<!DOCTYPE html>
<html lang="en">
<head>
  <title>Level 1: Print Power! üñ®Ô∏è</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@700&display=swap" rel="stylesheet" />
  <style>
    body {
      background: linear-gradient(135deg, orange 70%, gold 100%);
      color: #fff;
      margin: 0;
      font-family: 'Comic Neue', 'Comic Sans MS', cursive, sans-serif;
      min-height: 100vh;
      text-align: center;
    }
    /* Background decorations */
    .print-bg-scene { position: fixed; z-index: -1; inset: 0; width: 100vw; height: 100vh; overflow: hidden; pointer-events: none; background: linear-gradient(115deg, #ffe6bb 0%, #ffb5e6 70%, #ffd183 100%);}
    .desk-bg { position: absolute; bottom: 0; left: 0; width: 100vw; height: 22vh; background: linear-gradient(to top,#ffd183 40%,#fbeaca 100%); border-top-left-radius:60px; border-top-right-radius:60px; box-shadow: 0 -8px 62px 24px #ffca557a; z-index: 1;}
    .printer { position: absolute; right: 8vw; bottom: 15vh; width: 115px; height: 80px; background: linear-gradient(120deg,#e1e4ed 65%,#bcc2c6 98%); border-radius: 24px 28px 16px 16px / 20px 25px 24px 30px; box-shadow: 0 5px 14px #d1b98988; z-index: 2; }
    .printer::before { content:""; position:absolute; top:-24px; left:38px; width:38px; height:34px; background:#fff; border-radius:5px 5px 12px 12px; box-shadow:0 10px 12px #f9e9a3cc; z-index:3; animation: paper-slide 2.8s cubic-bezier(.51,0,.68,1.29) infinite alternate; }
    @keyframes paper-slide { 0% { top:-28px; opacity:.3; } 40% { top:-18px; opacity:1; } 70% { top:-8px; opacity:1; } 100% { top:-16px; opacity:.5; } }
    .printer::after { content:""; position:absolute; bottom:15px; left:47px; width:16px; height:10px; border-radius:10px; background:#7ed957; box-shadow:0 1px 2px #558e34c1; }
    .flying-paper { position: absolute; top: 10vh; left: 10vw; width: 48px; height: 30px; background: #fff; border-radius: 4px 8px 10px 10px; box-shadow: 0 2px 8px #ffc1d8aa; opacity: .82; animation: paper-fly1 7s linear infinite; transform:rotate(3deg); z-index:4;}
    .flying-paper2 { top: 19vh; left: 26vw; width: 42px; height: 24px; opacity: 0.7; animation: paper-fly2 8s linear infinite; background: #fffffa; filter: blur(.3px); transform: rotate(-10deg);}
    .flying-paper3 { top: 11vh; left: 70vw; animation: paper-fly3 12s linear infinite 2.9s; width: 36px; height: 18px; opacity: .54; background: #fffde1; filter: blur(1px); transform: rotate(18deg);}
    @keyframes paper-fly1 { 0%{top:10vh;left:11vw;transform:rotate(3deg);} 35%{top:18vh;left:40vw;transform:rotate(-24deg);} 65%{top:44vh;left:34vw;transform:rotate(-11deg);} 100%{top:56vh;left:71vw;transform:rotate(38deg); } }
    @keyframes paper-fly2 { 0%{top:19vh;left:26vw;} 70%{top:64vh;left:81vw;} 100%{top:71vh;left:92vw;} }
    @keyframes paper-fly3 { 0%{top:11vh;left:70vw;} 66%{top:51vh;left:20vw;} 100%{top:61vh;left:3vw;} }
    .cloud { position: absolute; background: #fff; border-radius:50%; opacity:.82; box-shadow: 60px 22px 0 0 #fff, 120px 31px 0 0 #fff, 170px 21px 0 0 #fff, 235px 55px 0 0 #fff, 268px 38px 0 0 #fff; width:120px; height:61px; top:10vh; left:12vw; filter:blur(0.4px); z-index:3; }
    .cloud2 { width:140px; height:74px; top:18vh; left:62vw; }
    .sparkle{ position:absolute; border-radius:50%; background:radial-gradient(circle,#fff9 55%,#fff0 100%); width:22px; height:22px; top:33vh; left:44vw; filter:blur(2.5px); opacity:.6; animation:sparkle1 4.1s infinite alternate; z-index:3; }
    .sparkle2{ width:12px; height:12px; left:25vw; top:60vh; animation:sparkle1 3s 1.2s infinite alternate; }
    .sparkle3{ width:16px; height:16px; left:77vw; top:21vh; animation:sparkle1 2.4s 0.4s infinite alternate; opacity:.35; filter:blur(1px); }
    @keyframes sparkle1 { 0%, 100% { opacity:.4; } 60% { opacity:.8; } }
    
    .main-container {
      max-width:710px;
      background: rgba(255,255,255,.11);
      border-radius:30px;
      box-shadow:0 8px 32px 0 rgba(31,38,135,0.23);
      margin:40px auto 60px auto;
      padding:38px 16px 32px 16px;
      position:relative;
      z-index:10;
      color:white;
      text-align:left;
      font-size: 1.15em;
      line-height: 1.45em;
    }
    h1 {
      background: linear-gradient(90deg,DodgerBlue,#ff5e62);
      padding:13px 38px;
      border-radius:18px;
      font-size:2.4em;
      margin-bottom:15px;
      color:white;
      text-shadow:2px 2px 7px #3337;
      letter-spacing:1.5px;
      font-family:'Comic Neue', cursive;
      text-align:center;
    }
    
    /* Progress bar and badges */
    .progress-row {
      width: 100%;
      margin: 14px 0 12px;
      text-align: center;
    }
    .progress-bar-bg {
      background-color: #ffd082;
      height: 18px;
      border-radius: 16px;
      box-shadow: 0 3px 9px #ffd082bb inset;
      width: 80%;
      max-width: 600px;
      margin: 0 auto;
      overflow: hidden;
      position: relative;
    }
    .progress-bar-fg {
      background: linear-gradient(90deg, #3b82f6 40%, #67e8f9 90%);
      height: 18px;
      width: 0%;
      border-radius: 16px 0 0 16px;
      transition: width 0.6s ease-in-out;
      box-shadow: 0 2px 6px #2563eb;
    }
    .badge-container {
      margin-top: 8px;
      text-align: center;
    }
    .badge {
      display: inline-block;
      padding: 6px 16px;
      font-weight: 700;
      border-radius: 14px;
      background: linear-gradient(90deg, #ffe082, #ffb300);
      color: #6b4900;
      box-shadow: 0 3px 10px #b07f00aa;
      margin: 0 7px;
      user-select: none;
      cursor: default;
    }

    /* Mascot bubble */
    .mascot-bubble {
      display: flex;
      align-items: flex-start;
      margin: 12px 0 24px 0;
      gap: 14px;
    }
    .mascot-face {
      font-size: 3.5em;
      user-select: none;
      line-height: 1;
    }
    .bubble-speech {
      position: relative;
      background: #fffbe8;
      color: #8d5500;
      font-size: 1.25em;
      font-family: 'Comic Neue', cursive;
      border-radius: 30px;
      padding: 18px 26px;
      max-width: 82%;
      box-shadow: 2px 5px 22px #ffecb350;
      line-height: 1.4;
    }
    .bubble-speech::after {
      content: "";
      position: absolute;
      bottom: -20px;
      left: 38px;
      border-width: 20px 18px 0 18px;
      border-style: solid;
      border-color: #fffbe8 transparent transparent transparent;
      filter: drop-shadow(0 1px 1px #d2b855a0);
    }

    /* Speech bubbles for content boxes */
    .speech-bubble {
      position: relative;
      border-radius: 40px;
      padding: 20px 26px;
      box-shadow: 2px 5px 20px rgba(255 255 255 / 0.22);
      max-width: 100%;
      margin: 24px 0;
      line-height: 1.4;
    }
    .speech-bubble::after {
      content: "";
      position: absolute;
      bottom: -24px;
      left: 40px;
      border-style: solid;
      border-color: transparent;
      filter: drop-shadow(0 1px 1px rgba(0,0,0,0.1));
    }
    .info-box.speech-bubble {
      background: #fffbe8;
      border: 2px solid #ffb300;
      color: #7e5704;
      box-shadow: 0 2px 12px #ffecb3aa;
    }
    .info-box.speech-bubble::after {
      border-width: 24px 24px 0 0;
      border-top-color: #fffbe8;
      left: 34px;
      bottom: -24px;
    }
    .example-box.speech-bubble {
      background: linear-gradient(90deg, #b3e5fc 70%, #81d4fa 100%);
      border-left: 8px solid #0288d1;
      color: red;
      box-shadow: 0 2px 12px #b3e5fcaa;
      border-radius: 40px;
      padding: 18px 26px;
      margin: 22px 0;
    }
    .example-box.green.speech-bubble {
      background: linear-gradient(90deg, #c8e6c9 70%, #a5d6a7 100%);
      border-left: 8px solid #388e3c;
      color: #00695c;
      box-shadow: 0 2px 12px #b2dfdb99;
    }
    .example-box.speech-bubble::after,
    .example-box.green.speech-bubble::after {
      border-width: 20px 20px 0 0;
      border-top-color: #b3e5fc;
      left: 30px;
      bottom: -20px;
    }
    .example-box.green.speech-bubble::after {
      border-top-color: #c8e6c9;
    }

    /* OUTPUT BOXES ONLY BLACK */
    #output1, #output2, #output3 {
      background: black;
      color: #95ffa4;
      border-radius: 40px;
      padding: 18px 26px;
      margin: 22px 0;
      white-space: pre-wrap;
      font-family: monospace;
      font-size: 1.15em;
      min-height: 40px;
      box-shadow: inset 0 0 10px #222;
    }
    /* Challenge Box */
    .challenge-box.speech-bubble {
      background: linear-gradient(90deg, #c8e6c9 70%, #a5d6a7 100%);
      border: 2px solid #388e3c;
      color: #005e36;
      box-shadow: 0 2px 12px #b2dfdb99;
      font-weight: bold;
      border-radius: 40px;
      padding: 24px 30px;
      margin: 28px 0;
    }
    .challenge-box.speech-bubble::after {
      border-width: 24px 24px 0 0;
      border-top-color: #c8e6c9;
      left: 40px;
      bottom: -24px;
    }
    /* Fun fact box */
    .fun-fact-box.speech-bubble {
      background: #fff3cd;
      border: 2px solid brown;
      border-left: 6px solid #ffd54f;
      color: #6f4e00;
      font-style: italic;
      text-align: left;
      box-shadow: 0 2px 12px #ffecb3aa;
      border-radius: 40px;
      padding: 24px 30px;
      margin: 24px auto;
    }
    .fun-fact-box.speech-bubble::after {
      border-width: 24px 24px 0 0;
      border-top-color: #fff3cd;
      left: 42px;
      bottom: -24px;
    }
    #challengeInput {
      width: 100%;
      font-family: monospace;
      font-size: 1.2em;
      border-radius: 14px;
      padding: 16px 20px;
      margin-top: 12px;
      min-height: 120px;
      box-sizing: border-box;
      resize: vertical;
      color: #000;
      border: 2px solid #388e3c;
      background: #fff;
      display: block;
    }
    .editable-example {
      width: 95%;
      font-family: inherit;
      font-size: 1.2em;
      border-radius: 12px;
      padding: 12px 12px;
      margin: 20px 0 30px 0;
      box-sizing: border-box;
      border: 2px solid #fbb03b;
      resize: vertical;
      background: #fff;
      display: block;
      text-align: center;
      height: 44px;
      line-height: 1.3;
      overflow-y: auto;
      color: #000;
    }
    /* Try it buttons */
    .example-btn {
      background: linear-gradient(90deg, #2563eb 70%, #60a5fa 100%);
      color: white;
      border: none;
      border-radius: 12px;
      padding: 10px 22px;
      font-weight: 700;
      font-family: 'Comic Sans MS', cursive, sans-serif;
      font-size: 1.15em;
      cursor: pointer;
      box-shadow: 0 5px 12px rgba(37, 99, 235, 0.7);
      transition: background-color 0.3s ease, transform 0.2s ease;
      user-select: none;
      white-space: nowrap;
      min-width: 96px;
    }
    .example-btn:hover {
      background: linear-gradient(90deg, #1e40af 70%, #3b82f6 100%);
      transform: scale(1.1);
      box-shadow: 0 7px 18px rgba(37, 99, 235, 0.9);
    }
    .example-btn:active {
      transform: scale(0.9);
      box-shadow: 0 3px 8px rgba(37, 99, 235, 0.5);
      transition: transform 0.1s ease;
    }
    .example-btn:focus {
      outline: 3px solid #0349d3;
      outline-offset: 2px;
    }
    .button-row {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 20px;
    }
    .button, .rainbow-btn {
      display: inline-block;
      color: white;
      padding: 18px 36px;
      border-radius: 12px;
      text-decoration: none;
      font-size: 1.3em;
      margin: 10px;
      font-family: 'Comic Sans MS', cursive, sans-serif;
      cursor: pointer;
      background: linear-gradient(90deg, #088F8F 80%, #357a6b 100%);
      box-shadow: 2px 4px 16px #0003;
      transition: background 0.3s, transform 0.2s;
      border: none;
      font-weight: bold;
      text-align: center;
    }
    .button:hover, .rainbow-btn:hover, .button.special:hover {
      background: linear-gradient(90deg, #357a6b 80%, #088F8F 100%);
      transform: scale(1.05) rotate(-2deg);
    }
    .button.special, .rainbow-btn {
      background: linear-gradient(90deg, #ff5e62 80%, #fbb03b 100%);
      color: #fff;
      font-weight: bold;
    }
    #scoreDisplay {
      font-weight: 900;
      font-size: 1.7em;
      margin-bottom: 20px;
      color: #fff;
      background-color: #3b82f6;
      border-radius: 12px;
      padding: 12px 25px;
      box-shadow: 2px 4px 16px #0003;
      text-align: center;
      width: fit-content;
      min-width: 160px;
      margin-left: auto;
      margin-right: auto;
      font-family: 'Arial Black', Gadget, sans-serif;
      user-select: none;
    }
  </style>
</head>
<body>
  <div class="print-bg-scene">
    <div class="cloud"></div>
    <div class="cloud cloud2"></div>
    <div class="sparkle"></div>
    <div class="sparkle sparkle2"></div>
    <div class="sparkle sparkle3"></div>
    <div class="desk-bg"></div>
    <div class="printer"></div>
    <div class="flying-paper"></div>
    <div class="flying-paper flying-paper2"></div>
    <div class="flying-paper flying-paper3"></div>
  </div>
  <main class="main-container" aria-label="Main Level One Content">
    <h1>Level 1: Print Power! üñ®Ô∏è</h1>
    <div class="progress-row" aria-label="Level Progress">
      <div class="progress-bar-bg">
        <div class="progress-bar-fg" id="progBarFG" style="width:0%;"></div>
      </div>
      <div class="badge-container">
        <span class="badge" id="badge-print">üñ®Ô∏è Print Pro Beginner</span>
        <span class="badge" id="badge-quest" style="opacity:0.5;">üåà Mini-Quest</span>
      </div>
    </div>
    <div id="scoreDisplay" aria-live="polite" title="Your total adventure score">üèÜ Score: 0</div>
    <div class="mascot-bubble" aria-live="polite">
      <div class="mascot-face" aria-hidden="true">ü¶ä</div>
      <div class="bubble-speech"><b>Hi adventurer!</b> <br>
        I'm Fizz the Fox, your guide! Ready to make your computer <b>say your name</b> with Python? Let's go! ü¶äüöÄ
      </div>
    </div>
    <div class="info-box speech-bubble" role="region" aria-label="Introduction">
      Welcome to your first <b>Python adventure</b>! üéâ<br>
      In this level, we'll teach your computer to <b>say things</b> using <code>print()</code>.<br>
      That's like <b>using your voice</b>‚Äîbut in computer language!
    </div>
    <div class="editable-input-wrap">
      <textarea class="editable-example" aria-label="Python code example" rows="1" style="font-size:1.19em;">print("Hello, world!")</textarea>
      <button class="example-btn" onclick="runExample(1)" aria-label="Try Example 1">Try it!</button>
    </div>
    <div id="output1" class="example-box" aria-live="polite"></div>
    <div class="example-box speech-bubble">
      <p>This line tells Python to show <b>Hello, world!</b> on the screen.<br>
        Change the message in quotes and hit <b>Try it!</b> to see your own message! üìù</p>
    </div>
    <div class="editable-input-wrap">
      <textarea class="editable-example" aria-label="Python code about animals" rows="1" style="font-size:1.2em;">print("My favorite animal is a cat!")</textarea>
      <button class="example-btn" onclick="runExample(2)" aria-label="Try Example 2">Try it!</button>
    </div>
    <div id="output2" class="example-box" aria-live="polite"></div>
    <div class="example-box green speech-bubble">
      <p>Print <b>anything you love</b>‚Äîlike your name, favorite animal, or favorite emoji! üò∏‚ú®</p>
    </div>
    <div class="editable-input-wrap">
      <textarea class="editable-example" aria-label="Python code about emoji" rows="1" style="font-size:1.19em;">print("üêç PyQuest is fun!")</textarea>
      <button class="example-btn" onclick="runExample(3)" aria-label="Try Example 3">Try it!</button>
    </div>
    <div id="output3" class="example-box" aria-live="polite"></div>
    <form class="challenge-box speech-bubble" id="challengeForm" autocomplete="off" onsubmit="return false;">
      <span>üåü Mini-Quest:</span>
      <p>
        Use <code>print()</code> to show your name!<br>
        <small>(Start with <code>print(</code> and make sure your name is <b>inside quotes</b>!)</small>
      </p>
      <textarea id="challengeInput" required spellcheck="false" placeholder='e.g. print("Sashreek")' aria-label="Type your print code here"></textarea>
      <div class="challenge-feedback" id="challengeFeedback"></div>
      <button id="nextBtn" class="button special" disabled>Next: More About Printing ‚û°Ô∏è</button>
    </form>
    <div class="fun-fact-box speech-bubble" role="region" aria-label="Fun Fact">
      üí° <b>Did you know?</b><br>
      You can print numbers and do math too! Try typing <code>print(7 * 3)</code> above!
      <br>And feel free to click <b>Try it!</b> as much as you want!
    </div>
    <div class="button-row">
      <a href="index.html" class="button">Back to Home</a>
      <a href="try-python.html" class="button special" aria-label="Open Python Playground">Try it Yourself!</a>
    </div>
    <div id="storyContainer" style="display:none;">
      <h2>‚öîÔ∏è Adventure Time!</h2>
      <div id="storyText"></div>
      <div id="storyChoices"></div>
      <div id="codeQuestionUI">
        <label for="codeAnswerInput"><b>Type your answer below (print statement):</b></label><br>
        <textarea id="codeAnswerInput" rows="3" placeholder='Type your print statement here...'></textarea>
        <div id="codeAnswerFeedback"></div>
        <button id="codeAnswerSubmitBtn" class="button special" disabled>Submit Answer</button>
        <button id="codeAnswerContinueBtn" class="button" style="display:none;">Continue</button>
      </div>
    </div>
    <div id="codeLensContainer" style="display:none; text-align:left;">
      <h2>üîç Code Lens - Step-by-Step Code Magic</h2>
      <pre id="codeLensLines"></pre>
      <button id="runCodeLensBtn">Run Code Step-by-Step ‚ñ∂Ô∏è</button>
      <div id="codeLensOutput"></div>
    </div>
  </main>
<script>
  // Score and UI updates
  const scoreDisplay = document.getElementById('scoreDisplay');
  let score = parseInt(localStorage.getItem('pyQuestScore')) || 0;
  scoreDisplay.textContent = `üèÜ Score: ${score}`;

  function updateScore(points) {
    score += points;
    localStorage.setItem('pyQuestScore', score);
    scoreDisplay.textContent = `üèÜ Score: ${score}`;
    if (score >= 10) {
      document.getElementById('badge-print').style.animation = 'badgepop 1.2s';
    }
    if (score >= 30) {
      document.getElementById('badge-quest').style.opacity = 1;
    }
  }

  function updateProgress(percent) {
    const progBar = document.getElementById('progBarFG');
    if (!progBar) return;
    progBar.style.width = percent + '%';
  }

  // Try it button handlers
  function runExample(idx) {
    const textarea = document.querySelectorAll('.editable-example')[idx - 1];
    const outbox = document.getElementById('output' + idx);
    const code = textarea.value.trim();
    const m = code.match(/^print\s*\(\s*(['"])([\s\S]*?)\1\s*\)$/);
    if (!m) {
      outbox.textContent = "Oops! Only simple print statements allowed here.";
      outbox.style.color = "#ff4267";
      return;
    }
    outbox.textContent = m[2];
    outbox.style.color = "#95ffa4";
    outbox.innerHTML += " <span style='font-size:1.2em;'>‚ú®</span>";
  }

  // Mini Quest validation and next button enable
  const challengeInput = document.getElementById('challengeInput');
  const challengeFeedback = document.getElementById('challengeFeedback');
  const nextBtn = document.getElementById('nextBtn');

  function validPrintName(line) {
    const regex = /^\s*print\s*\(\s*(['"])[^'"]+\1\s*\)\s*$/i;
    return regex.test(line.trim());
  }

  challengeInput.addEventListener('input', () => {
    const val = challengeInput.value.trim();
    if (!val) {
      challengeFeedback.textContent = '';
      challengeFeedback.className = 'challenge-feedback';
      nextBtn.disabled = true;
      return;
    }
    if (!val.match(/^print\s*\(/i)) {
      challengeFeedback.textContent = "Start with print( ...";
      challengeFeedback.className = 'challenge-feedback error';
      nextBtn.disabled = true;
      return;
    }
    if (!validPrintName(val)) {
      challengeFeedback.textContent = "Your name goes inside quotes! Like print(\"Maria\")";
      challengeFeedback.className = 'challenge-feedback error';
      nextBtn.disabled = true;
      return;
    }
    challengeFeedback.textContent = "Awesome! Ready for your adventure? üéâ";
    challengeFeedback.className = 'challenge-feedback success';
    nextBtn.disabled = false;
  });

  nextBtn.onclick = async () => {
    if (!nextBtn.disabled) {
      updateScore(10);
      updateProgress(33);
      confettiEffect(2500);
      nextBtn.disabled = true;
      challengeInput.disabled = true;
      document.getElementById('badge-quest').style.opacity = 1;
      await new Promise(r => setTimeout(r, 1450));
      document.getElementById('storyContainer').style.display = 'block';
      document.getElementById('codeLensContainer').style.display = 'block';
      nextBtn.style.display = 'none';
      startAdventure(challengeInput.value.trim());
      initCodeLens(challengeInput.value.trim());
      updateProgress(55);
    }
  };

  // Adventure game implementation
  // (Full storyNodes and displayNode as provided previously)
  // Please see the earlier assistant message for the full storyNodes and displayNode function

  // For brevity here, just example start function stub:
  function startAdventure(userCodeInput) {
    displayNode('start');
  }

  // Code Lens functions
  const codeLensLinesEl = document.getElementById('codeLensLines');
  const codeLensOutputEl = document.getElementById('codeLensOutput');
  const runCodeLensBtn = document.getElementById('runCodeLensBtn');

  function initCodeLens(userCode) {
    const lines = userCode.split('\n');
    const numberedLines = lines.map((line, i) => (i + 1) + '. ' + line);
    codeLensLinesEl.textContent = numberedLines.join('\n');
    codeLensOutputEl.textContent = '';
    codeLensOutputEl.style.color = '#f8f8f2';
  }

  async function runCodeLens(userCode) {
    const lines = userCode.split('\n');
    codeLensOutputEl.textContent = '';
    codeLensOutputEl.style.color = '#50fa7b';
    runCodeLensBtn.disabled = true;
    for (let i=0; i<lines.length; i++) {
      highlightLine(i);
      const line = lines[i].trim();
      if(line.startsWith('print(')) {
        const outputText = extractPrintStrings(line)[0] || '';
        codeLensOutputEl.textContent += outputText + '\n';
      } else {
        codeLensOutputEl.textContent += '(Skipped non-print line)\n';
      }
      await new Promise(r => setTimeout(r, 1800));
    }
    clearHighlight();
    runCodeLensBtn.disabled = false;
  }

  function extractPrintStrings(code) {
    const results = [];
    const m = code.match(/^print\s*\(\s*(['"])([\s\S]*?)\1\s*\)$/);
    if(m) results.push(m[2]);
    return results;
  }

  function highlightLine(lineIndex) {
    clearHighlight();
    let fullText = codeLensLinesEl.textContent;
    const textLines = fullText.split('\n');
    textLines[lineIndex] = '%HL%' + textLines[lineIndex] + '%HL%';
    const highlightedHTML = textLines.map(line => {
      if (line.startsWith('%HL%') && line.endsWith('%HL%')) {
        return `<span style="background:#3b82f6;padding:0 4px;border-radius:4px;color:#fff;">${line.slice(4, -4)}</span>`;
      }
      return line;
    }).join('\n');
    codeLensLinesEl.innerHTML = highlightedHTML;
  }

  function clearHighlight() {
    const text = codeLensLinesEl.textContent || '';
    codeLensLinesEl.textContent = text.replace(/%HL%/g, '');
  }

  runCodeLensBtn.onclick = () => {
    const code = challengeInput.value.trim();
    if (!code) {
      alert('Please enter code to run!');
      return;
    }
    runCodeLens(code);
  };

  // Confetti effect
  (function () {
    const canvas = document.createElement('canvas');
    canvas.id = 'confettiCanvas';
    canvas.style.position = 'fixed';
    canvas.style.pointerEvents = 'none';
    canvas.style.top = '0';
    canvas.style.left = '0';
    canvas.style.width = '100%';
    canvas.style.height = '100%';
    canvas.style.zIndex = '1000';
    document.body.appendChild(canvas);
    const ctx = canvas.getContext('2d');
    let W = window.innerWidth;
    let H = window.innerHeight;
    canvas.width = W;
    canvas.height = H;
    const confettiCount = 120;
    const confetti = [];
    function randomRange(min, max) { return Math.random() * (max - min) + min; }
    function Confetto() {
      this.x = Math.random() * W; this.y = Math.random() * H - H;
      this.r = randomRange(5, 10); this.d = (Math.random() * confettiCount) + 10;
      this.color = `hsl(${Math.floor(randomRange(0, 360))},70%,60%)`;
      this.tilt = randomRange(-10, 10);
      this.tiltAngle = 0; this.tiltAngleIncrement = randomRange(0.05, 0.1);
    }
    Confetto.prototype.draw = function () {
      ctx.beginPath(); ctx.lineWidth = this.r / 2; ctx.strokeStyle = this.color;
      ctx.moveTo(this.x + this.tilt + this.r / 4, this.y);
      ctx.lineTo(this.x + this.tilt, this.y + this.tilt + this.r / 4); ctx.stroke();
    };
    function initConfetti() {
      confetti.length = 0; for (let i = 0; i < confettiCount; i++) { confetti.push(new Confetto()); }
    }
    function draw() {
      ctx.clearRect(0, 0, W, H);
      for (let i = 0; i < confetti.length; i++) { confetti[i].draw(); }
      update();
    }
    function update() {
      for (let i = 0; i < confetti.length; i++) {
        let c = confetti[i]; c.tiltAngle += c.tiltAngleIncrement;
        c.y += (Math.cos(c.d) + 3 + c.r / 2) / 2; c.x += Math.sin(c.d);
        c.tilt = Math.sin(c.tiltAngle) * 15;
        if (c.y > H) { c.x = Math.random() * W; c.y = -10; }
      }
    }
    let animFrameId;
    function startConfetti() { if (!animFrameId) animFrameId = requestAnimationFrame(run); }
    function stopConfetti() {
      if (animFrameId) { cancelAnimationFrame(animFrameId); animFrameId = null; ctx.clearRect(0, 0, W, H); }
    }
    function run() { draw(); animFrameId = requestAnimationFrame(run); }
    window.confettiEffect = function (duration = 3000) {
      initConfetti(); startConfetti(); setTimeout(() => { stopConfetti(); }, duration);
    }
    window.addEventListener('resize', () => {
      W = window.innerWidth; H = window.innerHeight;
      canvas.width = W; canvas.height = H;
    });
  })();
</script>
</body>
</html>




